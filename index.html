<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="d3.v3.js"></script>
  <script src="d3.slider.js"></script>
  <link rel="stylesheet" href="d3.slider.css" />
</head>
<body>
<div class="wrapper">
  <h2>Slider value: <span id="slider1text">0</span></h2>
  <div id="slider1"></div>
  <div id="box1"></div>
  <div id="box2"></div>
</div>

<script>
  //Initialise variables
  var person = {firstName:"John", lastName:"Doe", age:50, eyeColor:"blue"};
var data =
[
  [
    [31,31,51,24,61,21,34,64,61,12],
    [41,53,16,32,56,23,34,63,23,42],
    [12,33,56,62,26,33,41,26,33,14],
    [21,23,76,12,66,33,22,62,33,41]
  ],
  [
    [60,13,35,44,26,12,24,54,16,32],
    [11,33,26,12,36,43,13,26,53,14],
    [22,63,26,12,56,23,11,46,23,11],
    [61,43,36,72,26,53,19,52,43,11]
  ]
];

  //create svg container and rect and set its color and initial opacity
  CreateRect("#box1","#000000",0.5);

d3.json('cabin.csv',function (error, data) {
          if(error) return console.warn(error);
          // var hubTime = 0;
          // var currentTime = 0;
          // var currentTimeArray = getCurrentTime();
          // var currHours = currentTimeArray[0];
          // var currMin = currentTimeArray[1];
          // var currTime_Zone = currentTimeArray[2];

          // $("#currentTime").append(currTime_Zone);
          // if(currHours<12) {
          //   currTime_Zone = currTime_Zone.substring(currTime_Zone.indexOf("AM"));
          // }
          // else {
          //   currTime_Zone = currTime_Zone.substring(currTime_Zone.indexOf("PM"));
          // }

          // currentTime = currHours + ":" + currMin;

          // var date = data.heartbeat.toString();
          
          // var hours = date.substring(11,13);
          // var minutes = date.substring(14,16);
          // hubTime = hours + ":" + minutes;
          console.log(data);
});

  //slider function to change opacity
  d3.select('#slider1').call(d3.slider().on("slide", function(evt, value) {      
        d3.select('#slider1text').text(Math.floor(value));
        //RectIntensity("#box1","rect",value/100);
        //RectIntensity ("#box2","circle",value/100)
        //console.log(value)
        //if(value<50){
          //console.log("small")
          //UpdateSvgCanvas("#box2",0)
        //}
        //else if(value>=50) {
          //console.log("big")
          UpdateSvgCanvas("#box2",value)
          d3.selectAll("circle").remove();
          UpdateInnerCir("#box2",value)
        //}
  }));
  CreateSvgCanvas("#box2")
  function UpdateSvgCanvas (DivID,count) {
    var max = 56;
    if(count>max){
      count=max;
    }
    value=max-count
      for(y=0;y<1;y++){
        for(x=0;x<10;x++){
          var smallsvg = d3.select("#inner-svg-"+y+"-"+x)
            .attr("y", 11+value)
            .attr("height", 57-value);
        }
      }
  }
  function UpdateInnerCir (DivID,count) {
    var max = 57;
    var dir = 1;
    if(count>max){
      count=max;
    }
      for(y=1;y<2;y++){
        for(x=0;x<10;x++){
          id="#inner-svg-"+y+"-"+x
          var smallsvg = d3.select(id)
            i=count
            i=Math.floor(i)
            while(i>0){
              if(dir==1){
                var circle = smallsvg.append("circle")
                .attr("cx", 5)
                .attr("cy", 5+25*i)
                .attr("r", 10)
                .attr("width", "100%")
                .attr("height", "100%")
                .style("fill", "#000")
                .style("opacity", "0.5");
                //console.log(5+25*i)
              }
              if(dir==0){
                var circle = smallsvg.append("circle")
                .attr("cx", 5)
                .attr("cy", 5+35*i)
                .attr("r", 10)
                .attr("width", "100%")
                .attr("height", "100%")
                .style("fill", "#000")
                .style("opacity", "0.5");
              } 
              i--;
            }
        }
      }   
  }

  function CreateSvgCanvas (DivID) {
    //creates a svg container that is svg
    var svgContainer = d3.select(DivID).append("svg")
      .attr("width", 1290)
      .attr("height", 800)
      .attr("x", 0)
      .attr("y", 0)
      .style("background-image", "url('train_up.png')")
      .style("background-repeat", "no-repeat")
      .style("margin-left", "70px");
      svgContainer.append("rect")
        .attr("width", "100%")
        .attr("height", "100%")
        .style("fill", "none")
        ;
      for(y=0;y<2;y++){
        for(x=0;x<7;x++){
          if(y==0){
            CreateInnverSvg(svgContainer,y+"-"+x,x*150+138,11,59);
          }
          if(y==1){
            CreateInnerCir(svgContainer,y+"-"+x,x*150+138,110,9,1);
            //create circles
           }
        }
      }
  }
  function CreateInnverSvg (svgContainer,id,xpos,ypos,count){
    var max = 56;
    if(count>max){
      count=max;
    }
    value=max-count
    var smallsvg = svgContainer.append("svg")
      .attr("x", xpos)
      .attr("y", ypos+value)
      .attr("id", "inner-svg-"+id)
      .attr("width", 96)
      .attr("height", 57-value);
      var rect = smallsvg.append("rect")
        .attr("x", 0)
        .attr("y", 0)
        .attr("width", "100%")
        .attr("height", "100%")
        .style("fill", "rgb(148, 14, 62)");
        //CreateInnerRandCircles (smallsvg,count);
  }
  function CreateInnerCir (svgContainer,id,xpos,ypos,count,dir) {
    //creates a svg container that is svg
      var smallsvg = svgContainer.append("svg")
        .attr("x", xpos)
        .attr("y", ypos)
        .attr("id", "inner-svg-"+id)
        .attr("width", 10)
        .attr("height", 400);
    for(i=0;i<count;i++){
      if(dir==1){
        var circle = smallsvg.append("circle")
        .attr("cx", 5)
        .attr("cy", 5+25*i)
        .attr("r", 10)
        .attr("width", "100%")
        .attr("height", "100%")
        .style("fill", "#000")
        .style("opacity", "0.5");
      }
      if(dir==0){
        var circle = smallsvg.append("circle")
        .attr("cx", 5)
        .attr("cy", 5+35*i)
        .attr("r", 10)
        .attr("width", "100%")
        .attr("height", "100%")
        .style("fill", "#000")
        .style("opacity", "0.5");
      } 
    }
  }
  //count can be from 0 - infinity
  //set first range of 0-10 as opacity 0.1 and width based on count
  //set second range of 10-20 as opacity 0.2 and width based on count -10
  function CreateInnerRandCircles (smallsvg,count){
    console.log("here"+smallsvg)
    //sense range 10, 20, 30 to 100 or more than that
    var range = Math.floor(count/10)
    var circle_op
    var circle_r
    //set opacity of circle
    circle_r = count/60*40
    // if(range<10){
    //   circle_op = range*0.1
    //   circle_r = count%10
    // }


    var circle = smallsvg.append("circle")
    .attr("cx", 40)
    .attr("cy", 40)
    .attr("r", circle_r)
    .attr("width", 20)
    .attr("height", 20)
    .style("fill", "#000")
    .style("opacity", "0.5");

  }
  function CreateRect (DivID, color, intensity) {
    //creates a svg container that is svg
    var svgContainer = d3.select(DivID).append("svg")
      .attr("width", 80)
      .attr("height", 50);
    var rectangle = svgContainer.append("rect")
      .attr("x", 10)
      .attr("y", 10)
      .attr("width", 65)
      .attr("height", 40)
      .style("fill", color)
      .style("opacity", intensity);
  }
  function RectIntensity (DivID,shape,intensity) {
    //select svg container and all the rectangles inside and change its intensity
    var svgContainer = d3.select(DivID).selectAll(shape);
      svgContainer.style("opacity", intensity);
  }
</script>
</body>
</html>