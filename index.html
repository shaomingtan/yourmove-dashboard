<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="d3.v3.js"></script>
  <script src="d3.slider.js"></script>
  <link rel="stylesheet" href="d3.slider.css" />
</head>
<body>
<div class="wrapper">
  <h2>Slider value: <span id="slider1text">0</span></h2>
  <div id="slider1"></div>
  <div id="box1"></div>
  <div id="box2"></div>
</div>

<script>
  //Initialise variables
  var person = {firstName:"John", lastName:"Doe", age:50, eyeColor:"blue"};
var data =
[
  [
    [31,31,51,24,61,21,34,64,61,12],
    [41,53,16,32,56,23,34,63,23,42],
    [12,33,56,62,26,33,41,26,33,14],
    [21,23,76,12,66,33,22,62,33,41]
  ],
  [
    [60,13,35,44,26,12,24,54,16,32],
    [11,33,26,12,36,43,13,26,53,14],
    [22,63,26,12,56,23,11,46,23,11],
    [61,43,36,72,26,53,19,52,43,11]
  ]
];

  //sankey test
  d3.json("sankey-formatted.json", function(error, graph) {
    var nodeMap = {};
      graph.nodes.forEach(function(x) { nodeMap[x.name] = x; });
      graph.links = graph.links.map(function(x) {
        return {
          source: nodeMap[x.source],
          target: nodeMap[x.target],
          value: x.value
        };
      });
    sankey
      .nodes(graph.nodes)
      .links(graph.links)
      .layout(32);
  });


  //create svg container and rect and set its color and initial opacity
  CreateRect("#box1","#000000",0.5);

  //slider function to change opacity
  d3.select('#slider1').call(d3.slider().on("slide", function(evt, value) {      
        d3.select('#slider1text').text(value);
        //RectIntensity("#box1","rect",value/100);
        //RectIntensity ("#box2","circle",value/100)
        //console.log(value)
        if(value<50){
          //console.log("small")
          UpdateSvgCanvas("#box2",0)
        }
        else if(value>=50) {
          //console.log("big")
          UpdateSvgCanvas("#box2",1)
        }
  }));
  CreateSvgCanvas("#box2")
  function UpdateSvgCanvas (DivID,index) {
    var svgContainer = d3.select(DivID).append("svg")
      for(y=0;y<4;y++){
        for(x=0;x<10;x++){
          var smallsvg = d3.select("#inner-svg-"+y+"-"+x)
          smallsvg.selectAll("circle").remove();
          CreateInnerRandCircles (smallsvg,data[index][y][x]);
        }
      }
  }
  function CreateSvgCanvas (DivID) {
    //creates a svg container that is svg
    var svgContainer = d3.select(DivID).append("svg")
      .attr("width", 1400)
      .attr("height", 600)
      .attr("x", 0)
      .attr("y", 0)
      .style("background-image", "url('http://newton-circus.com/wp-content/uploads/2013/10/MobileMovies-NCslider.jpg')");
      svgContainer.append("rect")
        .attr("width", "100%")
        .attr("height", "100%")
        .style("fill", "none")
        ;
      for(y=0;y<4;y++){
        for(x=0;x<10;x++){
          CreateInnverSvg(svgContainer,y+"-"+x,x*140+10,y*140,5);
        }
      }
  }
  function CreateInnverSvg (svgContainer,id,xpos,ypos,count){
    var smallsvg = svgContainer.append("svg")
      .attr("x", xpos)
      .attr("y", ypos)
      .attr("id", "inner-svg-"+id)
      .attr("width", 80)
      .attr("height", 80);
      var rect = smallsvg.append("rect")
        .attr("x", 0)
        .attr("y", 0)
        .attr("width", "100%")
        .attr("height", "100%")
        .style("fill", "rgb(241, 219, 212)");
        CreateInnerRandCircles (smallsvg,count);
  }
  //count can be from 0 - infinity
  //set first range of 0-10 as opacity 0.1 and width based on count
  //set second range of 10-20 as opacity 0.2 and width based on count -10
  function CreateInnerRandCircles (smallsvg,count){
    console.log("here"+smallsvg)
    //sense range 10, 20, 30 to 100 or more than that
    var range = Math.floor(count/10)
    var circle_op
    var circle_r
    //set opacity of circle
    circle_r = count/60*40
    // if(range<10){
    //   circle_op = range*0.1
    //   circle_r = count%10
    // }


    var circle = smallsvg.append("circle")
    .attr("cx", 40)
    .attr("cy", 40)
    .attr("r", circle_r)
    .attr("width", 20)
    .attr("height", 20)
    .style("fill", "#000")
    .style("opacity", "0.5");

  }
  function CreateRect (DivID, color, intensity) {
    //creates a svg container that is svg
    var svgContainer = d3.select(DivID).append("svg")
      .attr("width", 80)
      .attr("height", 50);
    var rectangle = svgContainer.append("rect")
      .attr("x", 10)
      .attr("y", 10)
      .attr("width", 65)
      .attr("height", 40)
      .style("fill", color)
      .style("opacity", intensity);
  }
  function RectIntensity (DivID,shape,intensity) {
    //select svg container and all the rectangles inside and change its intensity
    var svgContainer = d3.select(DivID).selectAll(shape);
      svgContainer.style("opacity", intensity);
  }
</script>
</body>
</html>